<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>AI EXP</title>
	<meta name="description" content="">
	<meta name="author" content="Kai Sun">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="/theme/bootstrap.min.css" rel="stylesheet">
	<link href="/theme/local.css" rel="stylesheet">
	<link href="/theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="AI EXP Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52589612-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="/">AI EXP</a>
			<ul class="nav">
					<li><a href="http://www.kaisun.org/">About me</a></li>
					<li><a href="/pages/yixin.html">Yixin</a></li>
					<li class="active"><a href="/category/blog.html">Blog</a></li>
					<li ><a href="/category/zhong-wen-bo-ke.html">中文博客</a></li>
			</ul>
			<p class="pull-right"><a href="/archives.html">[archives]</a> <a href="/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="http://www.kaisun.org/">My Home Page</a></li>
				<li><a href="http://nlp.cornell.edu/">Cornell NLP</a></li>
				<li><a href="http://speechlab.sjtu.edu.cn/">SJTU Speech Lab</a></li>
				<li><a href="http://gomocup.org/">Gomocup</a></li>
				<li><a href="http://speechlab.sjtu.edu.cn/~kyu/">Kai Yu</a></li>
				<li><a href="http://tcloud.sjtu.edu.cn/wiki/index.php/User:Liangalei">Alei Liang</a></li>
				<li><a href="http://www.cs.cornell.edu/jeh/">John E. Hopcroft</a></li>
				<li><a href="http://research.microsoft.com/en-us/people/frankkps/">Frank Soong</a></li>
				<li><a href="http://research.microsoft.com/en-us/people/lijuanw/">Lijuan Wang</a></li>
				<li><a href="http://www.cs.cornell.edu/home/cardie/">Claire Cardie</a></li>
				<li><a href="http://www.wind23.com/">Tianyi Hao</a></li>
				<li><a href="http://misakamm.com/blog/">Misakamm</a></li>
				<li><a href="http://chisbread.com/">Bread's blog</a></li>
				<li><a href="mailto:sunkaicn@gmail.com">Contact me</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				<li><a href="http://github.com/accreator">GitHub</a></li>
				<li><a href="http://stackoverflow.com/users/3881143/accreator">StackOverflow</a></li>
				<li><a href="https://www.linkedin.com/in/sunkaicn">LinkedIn</a></li>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>Implementing Elegant Quines in C with Preprocessing</h1></div>
		<div class="well small">Permalink: <a class="more" href="/implementing-elegant-quines-in-c-with-preprocessing.html">2014-08-01</a>
by <a class="url fn" href="/author/kai-sun.html">Kai Sun </a>
 in <a href="/category/blog.html">Blog</a>
tags: <a href="/tag/quine.html">Quine</a> <a href="/tag/cc.html">C/C++</a> <a href="/tag/preprocessing.html">Preprocessing</a> </div>
		<div><h2>1. Introduction</h2>
<p>The name "quine" was coined by Douglas Hofstadter, in his popular science book Gödel, Escher, Bach: An Eternal Golden Braid, in the honor of philosopher Willard Van Orman Quine (1908–2000), who made an extensive study of indirect self-reference, and in particular for the following paradox-producing expression, known as Quine's paradox:</p>
<p><code>"Yields falsehood when preceded by its quotation" yields falsehood when preceded by its quotation.</code></p>
<p>Concretely, the term "quine" is referred to a computer program which takes no input and produces a copy of its own source code as its only output. First appeared in Paul Bratley and Jean Millo's article "Computer Recreations: Self-Reproducing Automata" in 1972, the idea of quine is fascinating due to its self-reproducing feature. For amusement, programmers sometimes attempt to develop the shortest possible quine in any given programming language. Moreover, problems based on the idea of quine are popular in various code golf, which is a type of recreational computer programming competition in which participants strive to achieve the shortest possible code that implements a certain algorithm.</p>
<p>There are many theoretical results for quine. For example, it is possible to implement quine in any Turing complete programming language, as a direct consequence of Kleene's recursion theorem. However, this article focuses more on quines' implementation.</p>
<p>In some languages, quines are quite easy to be implemented, since in some languages, an empty program is a quine. Such an empty program, submitted as "the world's smallest self reproducing program", once won the "worst abuse of the rules" prize in the International Obfuscated C Code Contest. Another possible way to achieve self-reproducing is to use file operations to read its source code and print, which seems a bit cheating. All these kinds of trival cases are omitted in this article.</p>
<p>This article shows an easy, general, and elegant way to implement quines in C with preprocessing which not only have short length, but can easily do general purpose computations as well. The techniques in this article are widely used in various code golf.</p>
<p>The remainder of the article is organized as follows. In section 2, the preprocessing techniques used in this article are described. Section 3 shows how to implement quines.</p>
<h2>2. The C Preprocessing</h2>
<p>One of the major use of the preprocessor in C is to define macros, which is also used to implement quines in this article. A macro definition is usually of the following form:</p>
<div class="highlight"><pre><span></span><span class="cp">#define MACRO_NAME(arg1, arg2, ...) [code to expand to]</span>
</pre></div>


<p>For instance, a simple macro for multiplication might look like this:</p>
<div class="highlight"><pre><span></span><span class="cp">#define MULT(x, y) (x)*(y)</span>
</pre></div>


<p>After <code>MULT</code> is defined, one can write <code>MULT(4, 2+3)</code> and the preprocessor expands it to <code>(4)*(2+3)</code>.</p>
<p>Besides macro itself, the stringize or number-sign operator <code>#</code> is also used in this article, which can convert a macro parameter into a string constant. For instance, with the following macro  </p>
<div class="highlight"><pre><span></span><span class="cp">#define hello(a) printf(&quot;Hello &quot; #a)</span>
</pre></div>


<p>One can write <code>hello(Kai)</code> and the preprocessor expands it to <code>printf("Hello " "Kai")</code>.  </p>
<p>Now, it is high time for us to define the <em>magic operator</em> using macro and stringize operator:</p>
<div class="highlight"><pre><span></span><span class="cp">#define Q(x)char*s=#x;x</span>
</pre></div>


<p>It is easy to see how does the <em>magic operator</em> work with an example, which will be given in the next section.</p>
<h2>3. Quine Implementation</h2>
<p>With the <em>magic operator</em>, A simple quine can be implemented as follows:</p>
<div class="highlight"><pre><span></span><span class="cp">#define Q(x)char*s=#x;x</span>
<span class="n">Q</span><span class="p">(</span><span class="n">main</span><span class="p">(){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;#define Q(x)char*s=#x;x</span><span class="se">\n</span><span class="s">Q(%s)&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">);})</span>
</pre></div>


<p>Now, let us analyse the above quine. After expanding the macro, the code becomes:</p>
<div class="highlight"><pre><span></span><span class="kt">char</span><span class="o">*</span><span class="n">s</span><span class="o">=</span><span class="s">&quot;main(){printf(</span><span class="se">\&quot;</span><span class="s">#define Q(x)char*s=#x;x</span><span class="se">\n</span><span class="s">Q(%s)</span><span class="se">\&quot;</span><span class="s">,s);}&quot;</span><span class="p">;</span><span class="n">main</span><span class="p">(){</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;#define Q(x)char*s=#x;x</span><span class="se">\n</span><span class="s">Q(%s)&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">);}</span>
</pre></div>


<p>It can be seen that the variable <code>s</code> is a pointer pointing to the string of the code which is written as the parameter of macro <code>Q()</code>, that is, <code>main(){printf("#define Q(x)char*s=#x;x\nQ(%s)",s);}</code>, which is also the code after the definition of <code>s</code> for actual execution. Therefore, with <code>s</code>, in order to achieve self reproduceing, only <code>#define Q(x)char*s=#x;x</code> and <code>Q()</code> should be rewritten in <code>printf()</code> for output; the string of the other code can just be represented by <code>s</code>.</p>
<p>In fact, the approach described above is a general way for quine implementation, which can be seen by considering the following framework:</p>
<div class="highlight"><pre><span></span><span class="cp">#define Q(x)char*s=#x;x</span>
<span class="n">Q</span><span class="p">(</span> <span class="p">{</span><span class="n">A</span><span class="p">}</span> <span class="n">main</span><span class="p">(){</span> <span class="p">{</span><span class="n">B</span><span class="p">}</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;#define Q(x)char*s=#x;x</span><span class="se">\n</span><span class="s">Q(%s)&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">);</span> <span class="p">{</span><span class="n">C</span><span class="p">}</span> <span class="p">}</span> <span class="p">{</span><span class="n">D</span><span class="p">}</span> <span class="p">)</span>
</pre></div>


<p>In the framework, <code>{A}</code>, <code>{B}</code>, <code>{C}</code>, and <code>{D}</code> can be replaced by any legal code in C, and the feature of self reproducing still holds (In particular, if there exist other variables with identifier <code>s</code>, <code>s</code> should be replaced by some unused identifier).</p>
<p>With the approach with only a few modifications, we can go even further: implementing more general quines. For example, implement a general quine that outputs all its characters in the odd position when the user inputs "o" and outputs all its characters in the even position when the user inputs "e"; implement a general quine A that can output a general quine B, which can again output the general quine A, forming a "quine loop". As it is not difficult to implement both of them, here the solutions are not given, and these two problems are left for readers who are interested in the topic.</p>
<h2>References</h2>
<ol>
<li><a href="http://en.wikipedia.org/wiki/Quine_(computing)">http://en.wikipedia.org/wiki/Quine_(computing)</a></li>
<li><a href="http://en.wikipedia.org/wiki/Code_golf">http://en.wikipedia.org/wiki/Code_golf</a></li>
<li><a href="http://www.cprogramming.com/tutorial/cpreprocessor.html">http://www.cprogramming.com/tutorial/cpreprocessor.html</a></li>
<li><a href="http://www.tutorialspoint.com/cprogramming/c_preprocessors.htm">http://www.tutorialspoint.com/cprogramming/c_preprocessors.htm</a></li>
</ol></div>
		<!--<div>
			<h2>Comments</h2>
		<div>-->
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; Kai Sun</p>
		</footer>
	  </div>

	</div>
</body>
</html>